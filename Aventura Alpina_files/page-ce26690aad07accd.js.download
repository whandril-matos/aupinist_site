!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="960f312c-18ec-4456-90ea-62a98e2f9957",e._sentryDebugIdIdentifier="sentry-dbid-960f312c-18ec-4456-90ea-62a98e2f9957")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{2286:function(e,t,r){Promise.resolve().then(r.bind(r,7744))},7744:function(e,t,r){"use strict";r.r(t);var n=r(7437),s=r(2265),a=r(5154),i=r(7564),l=r(4206),u=r(7440),o=r(5231),c=r(6893),d=r(5360),f=r(4937),h=r(3191);t.default=()=>{var e;let t=(0,h.NL)(),{messageParent:r}=(0,a.Z)(),{data:g}=(0,o.tZ)(),[m,p]=(0,s.useState)(0),[v,w]=(0,s.useState)(!1),[b,x]=(0,s.useState)(!1),{data:y,isFetched:E}=(0,c.r)(),k=(null==y?void 0:y.filter(e=>e.status===i.h.STARTED))||[],D=(null==y?void 0:y.filter(e=>e.status===i.h.QUEUED))||[],j=(null==y?void 0:y.filter(e=>e.status===i.h.SUCCEEDED))||[],{data:_}=(0,d.Le)(),[N,S]=(0,s.useState)([]),T=(0,s.useRef)(null),R=(0,s.useRef)(null),U=(0,s.useRef)(0),{logEvent:C}=(0,f.N)();(0,s.useEffect)(()=>{if(E&&j){if(!T.current){T.current=[...j];return}T.current&&T.current.length!==j.length&&(p(e=>e+1),T.current=[...j],t.refetchQueries({queryKey:["user-segments"]}))}},[y,E]);let I=[...N].find(e=>e.status===i.h.STARTED),L=()=>{r({id:"finishedGeneration"}),p(0),j&&(T.current=[...j])},z=async e=>{if("receiveStylarToken"===e.data.id){let t=e.data.content;localStorage.setItem("@Stylar:access_token",t),window.location.reload()}"firstTimeUser"===e.data.id&&x(!0),"visitedSupportedSite"===e.data.id?C("Visited Supported Site",{url:e.data.content}):"manualEnableOnSite"===e.data.id&&C("Manual Enable On Site",{url:e.data.content})},A=()=>{x(!1),r({id:"firstTimeUser",content:"false"})};return(0,s.useEffect)(()=>{if(k&&D){let e=[...k,...D].filter(e=>"copy_outfit"===e.type);S(t=>t.length>0&&0===e.length&&U.current<3?(U.current=U.current+1,t):t.length>0&&0===e.length&&U.current>=3?(U.current=0,L(),[]):e)}},[y]),(0,s.useEffect)(()=>{if("true"!==localStorage.getItem("model-mode")||!_||!(null==g?void 0:g.activePhoto))return;let e=async e=>{let t=await (0,u.T)([null==g?void 0:g.activePhoto.imageURL,e.imageURL]);r({id:"replaceModel",content:{referenceImageURL:e.productImageURL,userImageB64:t}})};_.forEach(e)},[_,null==g?void 0:g.activePhoto]),(0,s.useEffect)(()=>(window.addEventListener("message",z),()=>{window.removeEventListener("message",z)})),(0,s.useEffect)(()=>{if(!y||!E)return;let e=(null==y?void 0:y.filter(e=>[i.h.FAILED,i.h.REJECTED].includes(e.status)))||[];if(!R.current&&e&&E){R.current=[...e];return}R.current&&e&&R.current.length!==e.length&&(w(!0),R.current=[...e])},[y,E]),(0,n.jsxs)("div",{className:"flex group relative h-full items-center pl-2 justify-start gap-1 max-w-[252px] min-w-[60px] w-fit pt-3",children:[(0,n.jsx)("button",{onClick:()=>{r({id:"hideActions"})},className:"w-4 h-4 absolute top-0 bottom-0 my-auto left-6 m-auto -z-50 group-hover:-top-12 opacity-0 group-hover:opacity-100 group-hover:left-0 duration-200 group-hover:z-50 bg-black/80 rounded-full flex items-center justify-center p-[1px]",children:(0,n.jsx)("img",{src:"/icons/close.svg",alt:""})}),(0,n.jsxs)("button",{onClick:()=>{r({id:"toggleContent"}),p(0),j&&(T.current=[...j]),b&&A(),v&&w(!1)},className:"relative duration-200 w-[60px] h-[60px] flex items-center justify-center opacity-75 hover:opacity-100 cursor-pointer ease-in-out",children:[(0,n.jsxs)("div",{className:"h-12 relative w-12 ".concat(b?"animate-bounce hover:animate-none bg-[#6117ff]":"bg-black/60 hover:duration-200"," rounded-full flex items-center justify-center border-2 border-white/20"),children:[!(N.length>0&&!I)&&(0,n.jsx)("img",{src:"/icons/logo.svg",alt:"",className:"h-8 w-8 absolute inset-0 m-auto z-10"}),I&&(0,n.jsx)("img",{src:(null==I?void 0:I.input.ref_image_url)||(null===(e=N[0])||void 0===e?void 0:e.input.ref_image_url)||"",alt:"",className:"h-full bg-gr w-full rounded-full object-cover z-10 animate-[pulse2_5s_ease-in-out_infinite] absolute inset-0 m-auto"}),N.length>0&&!I&&(0,n.jsx)("svg",{className:"h-full w-full animate-spin m-auto rounded-full absolute inset-0 z-30 bg-black/30 py-1",width:"16",height:"16",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z",className:"spinner_P7sC",fill:"#fff"})}),m>0&&(0,n.jsx)("div",{className:"z-30 absolute -top-2 -right-2 h-6 w-6 bg-[#FF2E00] rounded-full flex items-center justify-center",children:(0,n.jsx)("span",{className:" text-white font-poppins text-[10px] font-bold",children:m})}),v&&(0,n.jsx)("div",{className:"z-30 absolute -top-2 -right-2 h-5 w-5 bg-[#F2BE01] rounded-full flex items-center justify-center border-2 border-white"})]}),I&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-full h-full absolute inset-0 m-auto z-20",viewBox:"0 0 100 100",children:(0,n.jsx)("circle",{className:"text-indigo-500  progress-ring__circle stroke-current z-20",strokeWidth:"6",strokeLinecap:"square",cx:"50",cy:"50",r:"40",fill:"transparent",style:{strokeDashoffset:"calc(251.2 - (251.2 * ".concat((0,l.T)(I.startedAt,I.eta),") / 100)"),strokeDasharray:"251.2"}})}),(0,n.jsx)("svg",{className:"w-full h-full absolute inset-0 m-auto",viewBox:"0 0 100 100",children:(0,n.jsx)("circle",{className:"text-white  progress-ring__circle stroke-current z-10",strokeWidth:"6",strokeLinecap:"square",cx:"50",cy:"50",r:"40",fill:"transparent",strokeDasharray:"251.2",strokeDashoffset:"calc(251.2 - (251.2 * 100) / 100)"})})]})]})]})}},5154:function(e,t){"use strict";t.Z=()=>({messageParent:e=>{let{id:t,content:r}=e;window.parent.postMessage({id:t,content:r},"*")}})},7564:function(e,t,r){"use strict";var n,s;r.d(t,{h:function(){return n}}),(s=n||(n={})).FAILED="failed",s.STARTED="started",s.SUCCEEDED="succeeded",s.QUEUED="queued",s.REJECTED="rejected"},6893:function(e,t,r){"use strict";r.d(t,{r:function(){return u}});var n=r(932),s=r(6298),a=r(459);let i=()=>{let e=(0,a.Z)();return{getUserTasks:()=>e.get("/task/"),getTask:t=>e.get("/task/".concat(t))}},l=async()=>{try{let{getUserTasks:e}=i(),t=await e();if(null==t?void 0:t.data)return[...t.data];return[]}catch(e){console.log(e)}},u=()=>(0,n.a)({queryKey:["user-tasks"],queryFn:()=>l(),placeholderData:s.Wk,refetchOnMount:!0,refetchOnWindowFocus:!0,refetchOnReconnect:!0,structuralSharing:!1,refetchInterval:3e3})},4206:function(e,t,r){"use strict";r.d(t,{T:function(){return n}});let n=(e,t)=>{let r=new Date(t).getTime()-new Date(e).getTime(),n=Date.now()-new Date(e).getTime();return n/r*100>=100?100:n/r*100}}},function(e){e.O(0,[603,762,254,120,916,971,738,744],function(){return e(e.s=2286)}),_N_E=e.O()}]);