!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="adc4d3eb-73e8-4188-b7b7-ca8104dffc22",t._sentryDebugIdIdentifier="sentry-dbid-adc4d3eb-73e8-4188-b7b7-ca8104dffc22")}catch(t){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{5913:function(t,e,o){o.d(e,{K:function(){return l},Y:function(){return u}});var n=o(7437),r=o(2265),a=o(1591),c=o(3191);let i=(0,r.createContext)({}),u=t=>{let{children:e}=t,o=(0,c.NL)(),{data:u}=(0,a.i7)(),[l,s]=(0,r.useState)(""),d=new BroadcastChannel("collection_channel"),g=u||[],f=(0,r.useMemo)(()=>g.find(t=>t._id===l),[u,l]),v=t=>{s(t||""),location.pathname.includes("picker-mode")||(d.postMessage(t||""),localStorage.setItem("@Stylar:active_collection",t||""),window.parent.postMessage({id:"setActiveCollection",content:{key:"@Stylar:active_collection",value:t||""}},"*"))};return d.onmessage=t=>{location.pathname.includes("picker-mode")&&(console.log(t.data),v(t.data))},(0,r.useEffect)(()=>{o.refetchQueries({queryKey:["user-segments"]})},[null==f?void 0:f._id]),(0,r.useEffect)(()=>{let t=localStorage.getItem("@Stylar:active_collection");t&&(s(t),d.postMessage(t),(async()=>await o.refetchQueries({queryKey:["user-segments"]}))())},[]),(0,n.jsx)(i.Provider,{value:{collections:g||[],activeCollection:f,activeCollectionId:l,handleActiveCollection:v},children:e})},l=()=>(0,r.useContext)(i)},6530:function(t,e,o){o.d(e,{B:function(){return h},J:function(){return O}});var n=o(7437),r=o(2265),a=o(803),c=o(7440),i=o(459);let u=()=>{let t=(0,i.Z)();return{copyOutfit:e=>{let{sourceImageURL:o,referenceImageURL:n,gender:r,section:a}=e;return t.post("/outfit/copy-outfit",{sourceImageURL:o,referenceImageURL:n,gender:r.toLowerCase(),section:a})},copyOutfitAsync:e=>{let{referenceImageURL:o,section:n,productURL:r,productName:a,collection:c}=e,i=localStorage.getItem("@Stylar:access_token");return t.post("/outfit/copy-outfit-async",{referenceImageURL:o,section:n,productURL:r,productName:a,collection:c},{headers:{Authorization:"Bearer ".concat(i)}})},getUserOutfits:(e,o)=>t.get("/outfit/user-outfits/".concat(e,"?outfitStatus=").concat(a.f.APPROVED).concat(o?"&tryOnPhoto=".concat(o):""))}};var l=o(5231),s=o(5360),d=o(4937),g=o(5913),f=o(8697);let v=!1,y=t=>({category:t,imageURL:"",folderId:"",tryOnPhoto:"",user:"",productURL:"",productName:"",productImageURL:""}),m=t=>({category:t.category||a.F.TOP,imageURL:t.imageURL||"",collectionId:t.collectionId||"",tryOnPhoto:t.tryOnPhoto||"",user:t.user||"",productURL:t.productURL||"",productName:t.productName||"",productImageURL:t.productImageURL||"",product:t.product,brand:t.brand}),p=(0,r.createContext)({}),h=t=>{var e;let{children:o}=t,{copyOutfitAsync:i}=u(),{activeCollection:h,activeCollectionId:O}=(0,g.K)(),{data:P}=(0,l.tZ)(),{data:F}=(0,s.Le)(),{logEvent:T}=(0,d.N)(),[L,U]=(0,r.useState)(a.F.TOP),[R,S]=(0,r.useState)(50),[I,b]=(0,r.useState)({[a.F.BOTTOM]:y(a.F.BOTTOM),[a.F.TOP]:y(a.F.TOP),[a.F.FULL]:y(a.F.FULL)}),[_,w]=(0,r.useState)(""),[M,k]=(0,r.useState)(!1),B=t=>{if(t.imageURL){if(I[t.category].imageURL===t.imageURL&&t.tryOnPhoto===(null==P?void 0:P.activePhoto._id)){var e,o,n;if(t.category===a.F.FULL){let e=(null==P?void 0:null===(o=P.activePhoto.segments)||void 0===o?void 0:o.find(t=>t.category===a.F.TOP&&!t.productImageURL))||y(a.F.TOP),r=(null==P?void 0:null===(n=P.activePhoto.segments)||void 0===n?void 0:n.find(t=>t.category===a.F.BOTTOM&&!t.productImageURL))||y(a.F.BOTTOM);b(()=>({[a.F.BOTTOM]:m(r),[a.F.TOP]:m(e),[a.F.FULL]:y(t.category)}));return}let r=(null==P?void 0:null===(e=P.activePhoto.segments)||void 0===e?void 0:e.find(e=>e.category===t.category&&!e.productImageURL))||(null==F?void 0:F.find(e=>e.category===t.category));b(e=>({...e,[t.category]:r?m(r):y(t.category)}));return}b(e=>t.category===a.F.FULL?{[a.F.BOTTOM]:y(a.F.BOTTOM),[a.F.TOP]:y(a.F.TOP),[t.category]:m(t)}:{...e,[a.F.FULL]:y(a.F.FULL),[t.category]:m(t)})}},C=async t=>{let{referenceImageURL:e,section:o,productName:n,productURL:r}=t,a={referenceImageURL:e,section:o,productURL:r,productName:n,...O&&{collection:O}};try{T("Try On",a),await i(a)}catch(e){let t=setInterval(async()=>{try{await i(a),k(!1),clearInterval(t)}catch(t){console.log(t)}},1e4)}},D=t=>{var e,o,n;let r=(null==P?void 0:null===(e=P.user.tryOnPhotos)||void 0===e?void 0:e.find(e=>e._id===t))||null;if(r&&F){let e=(null===(o=r.segments)||void 0===o?void 0:o.find(t=>t.category===a.F.TOP&&!t.productImageURL))||(null==F?void 0:F.find(e=>e.category===a.F.TOP&&e.tryOnPhoto===t)),c=(null===(n=r.segments)||void 0===n?void 0:n.find(t=>t.category===a.F.BOTTOM&&!t.productImageURL))||F.find(e=>e.category===a.F.BOTTOM&&e.tryOnPhoto===t);if(!e&&!c){b({[a.F.BOTTOM]:y(a.F.BOTTOM),[a.F.TOP]:y(a.F.TOP),[a.F.FULL]:y(a.F.FULL)});return}e?B(m(e)):B(y(a.F.TOP)),c?B(m(c)):B(y(a.F.BOTTOM))}};return(0,r.useEffect)(()=>{var t;(null==P?void 0:null===(t=P.activePhoto)||void 0===t?void 0:t._id)&&(v=!1,D(null==P?void 0:P.activePhoto._id))},[JSON.stringify(null==P?void 0:P.activePhoto)]),(0,r.useEffect)(()=>{var t,e,o,n;if((null==P?void 0:null===(e=P.activePhoto)||void 0===e?void 0:null===(t=e.segments)||void 0===t?void 0:t.length)&&(null==P?void 0:null===(n=P.activePhoto)||void 0===n?void 0:null===(o=n.segments)||void 0===o?void 0:o.length)>0&&!v)return null==P||P.activePhoto.segments.forEach(t=>B(m(t))),()=>{v=!0}},[null==P?void 0:P.activePhoto.segments]),(0,r.useEffect)(()=>{var t,e;if(!(null==P?void 0:P.activePhoto.imageURL)||!I)return;let o=async()=>{try{if(P.activePhoto.imageURL){let t=await (0,c.T)([P.activePhoto.imageURL,...Object.values(I).map(t=>t.imageURL).filter(t=>!!t)]);w(t)}}catch(t){console.log(t)}};I.top.imageURL||I.full.imageURL||B((null==P?void 0:null===(t=P.activePhoto.segments)||void 0===t?void 0:t.find(t=>t.category===a.F.TOP&&!t.productImageURL))||(null==F?void 0:F.find(t=>t.category===a.F.TOP&&t.tryOnPhoto===P.activePhoto._id))||y(a.F.TOP)),I.bottom.imageURL||I.full.imageURL||B((null==P?void 0:null===(e=P.activePhoto.segments)||void 0===e?void 0:e.find(t=>t.category===a.F.BOTTOM&&!t.productImageURL))||(null==F?void 0:F.find(t=>t.category===a.F.BOTTOM&&t.tryOnPhoto===P.activePhoto._id))||y(a.F.BOTTOM)),o()},[I,null==P?void 0:null===(e=P.activePhoto)||void 0===e?void 0:e.imageURL]),(0,r.useEffect)(()=>{S(50)},[null==h?void 0:h._id]),(0,r.useEffect)(()=>{B({...f.no,category:"top"}),B({...f.no,category:"bottom"})},[O]),(0,n.jsx)(p.Provider,{value:{startGeneration:C,section:L,handleSection:t=>{U(t)},selectedSegments:I,handleSelectSegment:B,resetSelectedSegments:D,mergedImage:_,rateLimited:M,segmentsLimit:R,addSegmentsLimit:()=>{S(t=>t+50)}},children:o})},O=()=>(0,r.useContext)(p)},8697:function(t,e,o){o.d(e,{$4:function(){return a},no:function(){return c}});var n=o(8472),r=o(803);let a=t=>{try{let e={"Content-Type":"application/json"};if("undefined"!=typeof localStorage){let t=localStorage.getItem("@Stylar:access_token");t&&(e={...e,Authorization:"Bearer ".concat(t)})}return n.Z.create({baseURL:"".concat("https://outfit-api.stylar.com/api").concat(t),headers:e})}catch(e){return n.Z.create({baseURL:"".concat("https://outfit-api.stylar.com/api").concat(t)})}};a("/");let c={imageURL:"",productName:"",productURL:"",productImageURL:"",category:r.F.TOP}},803:function(t,e,o){var n,r,a,c;o.d(e,{F:function(){return r},f:function(){return n}}),(a=n||(n={})).PENDING="pending",a.APPROVED="approved",a.REJECTED="rejected",(c=r||(r={})).TOP="top",c.BOTTOM="bottom",c.FULL="full"},7440:function(t,e,o){o.d(e,{T:function(){return i},cn:function(){return c}});var n=o(30),r=o(6320),a=o(6164);function c(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];return(0,a.m6)((0,n.W)(e))}let i=async t=>(0,r.Z)(t.map(t=>t+"?".concat(new Date().getTime())),{crossOrigin:"anonymous"})},459:function(t,e,o){o.d(e,{Z:function(){return r}});var n=o(8472);let r=()=>{let t=n.Z.create({baseURL:"https://outfit-api.stylar.com/api"});return t.interceptors.request.use(t=>{try{let e=localStorage.getItem("@Stylar:access_token");return e&&(t.headers.Authorization="Bearer ".concat(e)),t}catch(t){return Promise.reject(t)}}),t}},1591:function(t,e,o){o.d(e,{i7:function(){return i}});var n=o(932),r=o(6298),a=o(1649);let c=async()=>{let{getUserCollections:t}=(0,a.a)(),e=await t();return e.data?e.data.collections:[]},i=()=>(0,n.a)({queryKey:["get-user-collections"],queryFn:c,placeholderData:r.Wk,structuralSharing:!1,refetchOnMount:!0,refetchOnWindowFocus:!0,refetchOnReconnect:!0})},1649:function(t,e,o){o.d(e,{a:function(){return r}});var n=o(459);let r=()=>{let t=(0,n.Z)();return{getUserCollections:async()=>t.get("/collection/"),deleteCollection:async e=>t.delete("/collection/".concat(e)),updateCollection:async e=>t.put("/collection/".concat(e.id),{...e}),createCollection:async e=>t.post("/collection",{...e}),getSharedCollection:async(e,o)=>t.get("/collection/".concat(e,"/shared/").concat(o)),createSharedCollection:async e=>t.post("/collection/".concat(e,"/shared/"))}}},5360:function(t,e,o){o.d(e,{Le:function(){return f},PK:function(){return d},sS:function(){return l}});var n=o(5524),r=o(932),a=o(6298),c=o(5345),i=o(5913),u=o(6530);let l=()=>{let{deleteSegment:t}=(0,c.k)();return(0,n.D)({mutationFn:t})},s=async t=>{let{getAllUserSegments:e}=(0,c.k)(),o=await e(t);return o.data?[...o.data]:[]},d=()=>{let{segmentsLimit:t}=(0,u.J)();return(0,r.a)({queryKey:["all-user-segments"],queryFn:()=>s(t),placeholderData:a.Wk,structuralSharing:!1,refetchOnMount:!0,refetchOnWindowFocus:!0,refetchOnReconnect:!0})},g=async(t,e)=>{let{getUserSegments:o}=(0,c.k)(),n=await o(t,e);return n.data?[...n.data]:[]},f=()=>{let{activeCollectionId:t}=(0,i.K)(),{segmentsLimit:e}=(0,u.J)();return(0,r.a)({queryKey:["user-segments",t],queryFn:()=>g(t,e),placeholderData:a.Wk,structuralSharing:!1,refetchOnMount:!0,refetchOnWindowFocus:!0,refetchOnReconnect:!0})}},5345:function(t,e,o){o.d(e,{k:function(){return r}});var n=o(459);let r=()=>{let t=(0,n.Z)();return{deleteSegment:e=>t.delete("/segment/delete-segment/".concat(e)),getUserSegments:(e,o)=>t.get("/segment/user-segments/segments",{params:{...e&&{collection:e},limit:o||50}}),saveSegment:e=>{let{category:o,imageURL:n,tryOnPhoto:r,user:a,productName:c,productURL:i,productImageURL:u}=e;return t.post("/segment/save-segment",{category:o,imageURL:n,tryOnPhoto:r,user:a,productName:null==c?void 0:c.trim(),productURL:i,productImageURL:u})},getAllUserSegments:e=>t.get("/segment/all-user-segments",{params:{limit:e||50}})}}},4937:function(t,e,o){o.d(e,{N:function(){return a}});var n=o(4681),r=o.n(n);o(357);let a=()=>(r().init("0be848c0529cf09b8cfc423dfd024ada",{debug:!1,ignore_dnt:!0,api_host:"https://t.stylar.com"}),{identifyUser:(t,e,o,n)=>{r().identify(t),r().people.set({$email:o,$phone:n,$name:e})},logEvent:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r().track(t,e)}})},5231:function(t,e,o){o.d(e,{IG:function(){return l},Io:function(){return u},Qg:function(){return i},YJ:function(){return s},tZ:function(){return g}});var n=o(5524),r=o(932),a=o(6298),c=o(7854);let i=()=>{let{upgradeUser:t}=(0,c.p)();return(0,n.D)({mutationFn:t})},u=()=>{let{updateUser:t}=(0,c.p)();return(0,n.D)({mutationFn:t})},l=()=>{let{activateTryOnPhoto:t}=(0,c.p)();return(0,n.D)({mutationFn:t})},s=()=>{let{deleteUserPhoto:t}=(0,c.p)();return(0,n.D)({mutationFn:t})},d=async()=>{try{var t;let{getUser:e}=(0,c.p)(),o=(await e()).data.user,n=(null==o?void 0:null===(t=o.tryOnPhotos)||void 0===t?void 0:t.find(t=>t.active))||{imageURL:""};return{user:o,activePhoto:n}}catch(t){console.log(t)}},g=()=>(0,r.a)({queryKey:["current-user"],queryFn:d,placeholderData:a.Wk,structuralSharing:!1,refetchOnMount:!0,refetchOnWindowFocus:!0,refetchOnReconnect:!0})},7854:function(t,e,o){o.d(e,{p:function(){return r}});var n=o(459);let r=()=>{let t=(0,n.Z)();return{getUser:()=>t.get("/user/me"),updateUser:e=>{let{userId:o,body:n}=e;return t.put("/user/".concat(o),n)},getOutfitStats:e=>t.get("/user/".concat(e,"/outfitStats")),activateTryOnPhoto:e=>{let{userId:o,tryOnPhotoId:n}=e;return t.post("/user/".concat(o,"/activateTryOnPhoto"),{tryOnPhotoId:n})},getPresetPhotos:()=>t.post("/user/presetPhotos"),addPresetPhoto:e=>{let{id:o,url:n}=e;return t.post("/user/".concat(o,"/addPresetPhoto"),{url:n})},uploadUserImage:e=>{let{id:o,image:n}=e,r=new FormData;return r.append("image",n),t.post("/user/".concat(o,"/uploadPhoto"),r,{headers:{"Content-Type":"multipart/form-data"}})},checkCredentials:e=>{let{code:o,email:n,phone:r,google:a}=e;return t.post("/user/login",{phone:r,email:n,code:o,google:a})},sendCodeToEmail:e=>t.post("/user/verification-code",{email:e}),sendCodeToPhone:e=>t.post("/user/verification-code",{phone:e}),deleteUserPhoto:e=>t.delete("/user/try-on-photo/".concat(e)),upgradeUser:e=>t.post("/user/upgrade",{code:e})}}}}]);